<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="685px" preserveAspectRatio="none" style="width:573px;height:685px;" version="1.1" viewBox="0 0 573 685" width="573px" zoomAndPan="magnify"><defs><filter height="300%" id="f1q430drhexelw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="170.7969" style="stroke: #383838; stroke-width: 1.0;" width="10" x="111" y="93.5625"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="170.7969" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="93.5625"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="74.832" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="337.1914"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="74.832" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="538.1211"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="54.2656" style="stroke: #383838; stroke-width: 1.0;" width="10" x="303" y="168.3945"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="140.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="303" y="472.2891"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="217.0625" style="stroke: #000000; stroke-width: 2.0;" width="549" x="13" y="55.2969"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="296" x="67" y="286.3594"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="193.9297" style="stroke: #000000; stroke-width: 2.0;" width="388" x="57" y="434.0234"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="368" x="67" y="487.2891"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="116" x2="116" y1="38.2969" y2="644.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="211.5" x2="211.5" y1="38.2969" y2="644.9531"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="307.5" x2="307.5" y1="38.2969" y2="644.9531"/><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="74" x="77" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="84" y="22.9951">NauCore</text><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="74" x="77" y="643.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="84" y="663.9482">NauCore</text><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="73" x="173.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="180.5" y="22.9951">Gateway</text><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="73" x="173.5" y="643.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="180.5" y="663.9482">Gateway</text><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="51" x="280.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="287.5" y="22.9951">NATS</text><rect fill="#F8F8F8" filter="url(#f1q430drhexelw)" height="30.2969" style="stroke: #383838; stroke-width: 1.5;" width="51" x="280.5" y="643.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="287.5" y="663.9482">NATS</text><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="170.7969" style="stroke: #383838; stroke-width: 1.0;" width="10" x="111" y="93.5625"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="170.7969" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="93.5625"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="74.832" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="337.1914"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="74.832" style="stroke: #383838; stroke-width: 1.0;" width="10" x="207" y="538.1211"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="54.2656" style="stroke: #383838; stroke-width: 1.0;" width="10" x="303" y="168.3945"/><rect fill="#FFFFFF" filter="url(#f1q430drhexelw)" height="140.6641" style="stroke: #383838; stroke-width: 1.0;" width="10" x="303" y="472.2891"/><path d="M13,55.2969 L241,55.2969 L241,62.2969 L231,72.2969 L13,72.2969 L13,55.2969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="217.0625" style="stroke: #000000; stroke-width: 2.0;" width="549" x="13" y="55.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="28" y="68.3638">Request NauCore-&gt;NATS</text><polygon fill="#383838" points="195,89.5625,205,93.5625,195,97.5625,199,93.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="121" x2="201" y1="93.5625" y2="93.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="128" y="88.4966">Request</text><polygon fill="#ECECEC" filter="url(#f1q430drhexelw)" points="157,106.5625,266,106.5625,276,117.5625,266,129.5625,157,129.5625,147,117.5625,157,106.5625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="159" y="122.6294">handleRequest()</text><polygon fill="#383838" points="291,164.3945,301,168.3945,291,172.3945,295,168.3945" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="217" x2="297" y1="168.3945" y2="168.3945"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="224" y="163.3286">Request</text><path d="M318,139.6953 L318,179.6953 L553,179.6953 L553,149.6953 L543,139.6953 L318,139.6953 " fill="#ECECEC" filter="url(#f1q430drhexelw)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M543,139.6953 L543,149.6953 L553,149.6953 L543,139.6953 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="324" y="156.7622">Заменяет ID запроса NauCore,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="324" y="171.895">на автогенерируемый ID NATSа</text><polygon fill="#383838" points="228,218.6602,218,222.6602,228,226.6602,224,222.6602" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="222" x2="307" y1="222.6602" y2="222.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="234" y="217.5942">Response</text><path d="M23,193.9609 L23,233.9609 L198,233.9609 L198,203.9609 L188,193.9609 L23,193.9609 " fill="#ECECEC" filter="url(#f1q430drhexelw)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M188,193.9609 L188,203.9609 L198,203.9609 L188,193.9609 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="29" y="211.0278">Производим обратную</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="29" y="226.1606">замену ID</text><polygon fill="#383838" points="127,260.3594,117,264.3594,127,268.3594,123,264.3594" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="211" y1="264.3594" y2="264.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="133" y="259.2935">Response</text><path d="M67,286.3594 L309,286.3594 L309,293.3594 L299,303.3594 L67,303.3594 L67,286.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="296" x="67" y="286.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="82" y="299.4263">Command NauCore-&gt;NATS</text><polygon fill="#383838" points="195,333.1914,205,337.1914,195,341.1914,199,337.1914" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="116" x2="201" y1="337.1914" y2="337.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="123" y="332.1255">Command</text><path d="M222,308.4922 L222,348.4922 L354,348.4922 L354,318.4922 L344,308.4922 L222,308.4922 " fill="#ECECEC" filter="url(#f1q430drhexelw)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M344,308.4922 L344,318.4922 L354,318.4922 L344,308.4922 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="228" y="325.5591">Отправляем без</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="228" y="340.6919">преобразований</text><polygon fill="#ECECEC" filter="url(#f1q430drhexelw)" points="150,362.7578,274,362.7578,284,373.7578,274,385.7578,150,385.7578,140,373.7578,150,362.7578" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="152" y="378.8247">handleCommand()</text><polygon fill="#383838" points="296,408.0234,306,412.0234,296,416.0234,300,412.0234" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="212" x2="302" y1="412.0234" y2="412.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="219" y="406.9575">Publish</text><path d="M57,434.0234 L265,434.0234 L265,441.0234 L255,451.0234 L57,451.0234 L57,434.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="193.9297" style="stroke: #000000; stroke-width: 2.0;" width="388" x="57" y="434.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="72" y="447.0903">Event NauCore-&gt;NATS</text><polygon fill="#383838" points="127,468.2891,117,472.2891,127,476.2891,123,472.2891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="121" x2="302" y1="472.2891" y2="472.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="133" y="467.2231">Command\Request</text><path d="M67,487.2891 L144,487.2891 L144,494.2891 L134,504.2891 L67,504.2891 L67,487.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="368" x="67" y="487.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="82" y="500.356">loop</text><line style="stroke: #383838; stroke-width: 1.0;" x1="205" x2="195" y1="538.1211" y2="534.1211"/><line style="stroke: #383838; stroke-width: 1.0;" x1="205" x2="195" y1="538.1211" y2="542.1211"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="116" x2="206" y1="538.1211" y2="538.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="123" y="533.0552">Event</text><path d="M222,509.4219 L222,549.4219 L426,549.4219 L426,519.4219 L416,509.4219 L222,509.4219 " fill="#ECECEC" filter="url(#f1q430drhexelw)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M416,509.4219 L416,519.4219 L426,519.4219 L416,509.4219 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="228" y="526.4888">Если в Event есть ID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="228" y="541.6216">то подставляем его в Subj</text><polygon fill="#ECECEC" filter="url(#f1q430drhexelw)" points="165,563.6875,258,563.6875,268,574.6875,258,586.6875,165,586.6875,155,574.6875,165,563.6875" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="167" y="579.7544">handleEvent()</text><polygon fill="#383838" points="296,608.9531,306,612.9531,296,616.9531,300,612.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="212" x2="302" y1="612.9531" y2="612.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="219" y="607.8872">Publish</text><!--
@startuml

skinparam {
    monochrome true
}

participant NauCore order 1
participant Gateway order 2
participant NATS order 3

group Request NauCore->NATS
    NauCore -> Gateway: Request
    activate NauCore
    activate Gateway
    hnote over Gateway: handleRequest()
    Gateway -> NATS: Request
    note right: Заменяет ID запроса NauCore,\nна автогенерируемый ID NATSа
    activate NATS
    Gateway <- - NATS: Response
    deactivate NATS
    note left: Производим обратную\nзамену ID
    NauCore <- - Gateway: Response
    deactivate Gateway
    deactivate NauCore
end

group Command NauCore->NATS
    NauCore -> Gateway: Command
    activate Gateway
    hnote over Gateway: handleCommand()
    note right: Отправляем без\nпреобразований
    Gateway -> NATS: Publish
    deactivate Gateway
end

group Event NauCore->NATS
    NauCore <- NATS: Command\Request
    activate NATS
    loop
        NauCore - ->> Gateway: Event
        activate Gateway
        hnote over Gateway: handleEvent()
        note right: Если в Event есть ID,\nто подставляем его в Subj
        Gateway -> NATS: Publish
        deactivate Gateway
        deactivate NATS
    end
end

@enduml

PlantUML version 1.2018.11(Sat Sep 22 21:43:53 YEKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Linux
OS Version: 4.15.0-45-generic
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>