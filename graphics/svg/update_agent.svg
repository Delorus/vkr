<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1926.0001px" preserveAspectRatio="none" style="width:916px;height:1926px;" version="1.1" viewBox="0 0 916 1926" width="916.8px" zoomAndPan="magnify"><defs><filter height="300%" id="fyrpr36bukvc9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.4000000953674316"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.800000190734863" dy="4.800000190734863" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="21.6" lengthAdjust="spacingAndGlyphs" textLength="388.8" x="259.2" y="32.0496">Алгоритм обновления состояния</text><text fill="#000000" font-family="sans-serif" font-size="21.6" lengthAdjust="spacingAndGlyphs" textLength="120" x="397.2" y="57.1934">оператора</text><ellipse cx="457.8" cy="74.2875" fill="#000000" filter="url(#fyrpr36bukvc9)" rx="12" ry="12" style="stroke: none; stroke-width: 1.2000000476837158;"/><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="301.2" x="307.2" y="110.2875"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="277.2" x="319.2" y="135.6539">Получение сообщения FullBuddyList</text><rect fill="#FFFFFF" filter="url(#fyrpr36bukvc9)" height="278.5313" style="stroke: #000000; stroke-width: 2.4000000953674316;" width="331.2" x="292.2" y="164.0121"/><path d="M562.2,165.2121 L562.2,175.1684 L550.2,187.1684 L292.2,187.1684 " fill="none" style="stroke: #000000; stroke-width: 2.4000000953674316;"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="258" x="295.8" y="180.8063">Добавление задач в очередь</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="57.525" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="290.4" x="312.6" y="207.5684"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="254.4" x="324.6" y="232.9348">Добавление задачи обновления</text><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="266.4" x="324.6" y="249.6973">списка логинов и номеров в кэше</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="57.525" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="284.4" x="315.6" y="289.0934"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="255.6" x="327.6" y="314.4598">Добавление задачи обновление</text><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="327.6" y="331.2223">состояния оператора</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="57.525" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="307.2" x="304.2" y="370.6184"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="236.4" x="316.2" y="395.9848">Добавление задачи удаление</text><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="283.2" x="316.2" y="412.7473">отсутствующих операторв из кэша</text><rect fill="#000000" filter="url(#fyrpr36bukvc9)" height="7.2" rx="3" ry="3" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="891.6" x="12" y="466.5434"/><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="243.6" x="336" y="497.7434"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="219.6" x="348" y="523.1098">Получение задач из очреди</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="358.8" x="278.4" y="562.5059"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="334.8" x="290.4" y="587.8723">Обновление списка логинов у операторов</text><rect fill="#FFFFFF" filter="url(#fyrpr36bukvc9)" height="1165.7995" style="stroke: #000000; stroke-width: 2.4000000953674316;" width="858" x="28.8" y="616.2305"/><path d="M370.8,617.4305 L370.8,627.3867 L358.8,639.3867 L28.8,639.3867 " fill="none" style="stroke: #000000; stroke-width: 2.4000000953674316;"/><text fill="#000000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="330" x="32.4" y="633.0246">Обновление состояния у операторов</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="391.8,659.7867,523.8,659.7867,538.2,674.1867,523.8,688.5867,391.8,688.5867,377.4,674.1867,391.8,659.7867" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="132" x="391.8" y="678.7565">Оператор онлайн?</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="359.4" y="671.0737">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="538.2" y="671.0737">нет</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="360" x="85.8" y="700.5867"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="336" x="97.8" y="725.9532">Изменение статуса оператора на "online"</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="360" x="469.8" y="700.5867"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="336" x="481.8" y="725.9532">Изменение статуса оператора на "offline"</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="457.8,748.5492,472.2,762.9492,457.8,777.3492,443.4,762.9492,457.8,748.5492" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="301.2,801.3493,614.4,801.3493,628.8,815.7493,614.4,830.1493,301.2,830.1493,286.8,815.7493,301.2,801.3493" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="313.2" x="301.2" y="820.319">Оператор ранее уже был сохранен в кэше?</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="268.8" y="812.6362">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="628.8" y="812.6362">нет</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="188.4" x="159.9" y="900.2321"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="164.4" x="171.9" y="925.5985">Обновление статуса</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="84.3,842.1493,423.9,842.1493,438.3,856.5493,423.9,870.9493,84.3,870.9493,69.9,856.5493,84.3,842.1493" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="258.9" y="883.2018">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="339.6" x="84.3" y="861.119">Статус оператора отличается от сохраненого?</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="254.1,964.9946,268.5,979.3946,254.1,993.7946,239.7,979.3946,254.1,964.9946" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="369.6" x="476.7" y="842.1493"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="345.6" x="488.7" y="867.5157">Сохранение нового состояния у оператора</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="457.8,1000.9946,472.2,1015.3946,457.8,1029.7946,443.4,1015.3946,457.8,1000.9946" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="55.8,1053.7946,347.4,1053.7946,361.8,1068.1946,347.4,1082.5946,55.8,1082.5946,41.4,1068.1946,55.8,1053.7946" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="206.4" y="1094.8471">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="291.6" x="55.8" y="1072.7643">Оператор перешел в состояние wrapup?</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="321.6" x="40.8" y="1120.6471"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="297.6" x="52.8" y="1146.0135">Сохранение временной метки в Redis</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="458.4,1053.7946,742.8,1053.7946,757.2,1068.1946,742.8,1082.5946,458.4,1082.5946,444,1068.1946,458.4,1053.7946" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="605.4" y="1094.8471">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="284.4" x="458.4" y="1072.7643">Оператор вышел из состояния wrapup?</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="313.2" x="444" y="1120.6471"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="289.2" x="456" y="1146.0135">Удаление временной метки из Redis</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="428.4" x="386.4" y="1185.4096"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="404.4" x="398.4" y="1210.776">Подсчет времени нахождения в состоянии wrapup</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="346.8" x="427.2" y="1250.1721"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="322.8" x="439.2" y="1275.5385">Сохранение полученных данных в ns_acw</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="476.4" x="219.6" y="1397.0174"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="452.4" x="231.6" y="1422.3838">Подсчет времени нахождения в предыдущем состоянии</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="417.6" x="249" y="1461.7799"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="393.6" x="261" y="1487.1463">Сохранение полученных данных в ns_agent_status</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="506.4" x="204.6" y="1544.5424"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="482.4" x="216.6" y="1569.9089">Подсчет времени нахождения в предыдущем подсостоянии</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="452.4" x="231.6" y="1609.3049"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="428.4" x="243.6" y="1634.6714">Сохранение полученных данных в ns_agent_sub_status</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="288,1338.9346,627.6,1338.9346,642,1353.3346,627.6,1367.7346,288,1367.7346,273.6,1353.3346,288,1338.9346" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="18" x="462.6" y="1379.9872">да</text><text fill="#000000" font-family="sans-serif" font-size="13.2" lengthAdjust="spacingAndGlyphs" textLength="339.6" x="288" y="1357.9044">Статус оператора отличается от сохраненого?</text><polygon fill="#FEFECE" filter="url(#fyrpr36bukvc9)" points="457.8,1674.0674,472.2,1688.4674,457.8,1702.8675,443.4,1688.4674,457.8,1674.0674" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="250.8" x="332.4" y="1726.8675"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="226.8" x="344.4" y="1752.2339">Отправка изменений в Redis</text><rect fill="#FEFECE" filter="url(#fyrpr36bukvc9)" height="40.7625" rx="15" ry="15" style="stroke: #A80036; stroke-width: 1.8000000715255737;" width="319.2" x="298.2" y="1806.03"/><text fill="#000000" font-family="sans-serif" font-size="14.4" lengthAdjust="spacingAndGlyphs" textLength="295.2" x="310.2" y="1831.3964">Удаление отсутсвующих операторов</text><ellipse cx="457.8" cy="1882.7925" fill="none" filter="url(#fyrpr36bukvc9)" rx="12" ry="12" style="stroke: #000000; stroke-width: 1.2000000476837158;"/><ellipse cx="458.4" cy="1883.3925" fill="#000000" filter="url(#fyrpr36bukvc9)" rx="7.2" ry="7.2" style="stroke: none; stroke-width: 1.2000000476837158;"/><rect fill="#000000" filter="url(#fyrpr36bukvc9)" height="7.2" rx="3" ry="3" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="891.6" x="12" y="1906.7925"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="86.2875" y2="110.2875"/><polygon fill="#A80036" points="453,98.2875,457.8,110.2875,462.6,98.2875,457.8,103.0875" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="265.0934" y2="289.0934"/><polygon fill="#A80036" points="453,277.0934,457.8,289.0934,462.6,277.0934,457.8,281.8934" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="346.6184" y2="370.6184"/><polygon fill="#A80036" points="453,358.6184,457.8,370.6184,462.6,358.6184,457.8,363.4184" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="151.05" y2="207.5684"/><polygon fill="#A80036" points="453,195.5684,457.8,207.5684,462.6,195.5684,457.8,200.3684" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="538.5059" y2="562.5059"/><polygon fill="#A80036" points="453,550.5059,457.8,562.5059,462.6,550.5059,457.8,555.3059" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="377.4" x2="265.8" y1="674.1867" y2="674.1867"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="265.8" x2="265.8" y1="674.1867" y2="700.5867"/><polygon fill="#A80036" points="261,688.5867,265.8,700.5867,270.6,688.5867,265.8,693.3867" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="538.2" x2="649.8" y1="674.1867" y2="674.1867"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="649.8" x2="649.8" y1="674.1867" y2="700.5867"/><polygon fill="#A80036" points="645,688.5867,649.8,700.5867,654.6,688.5867,649.8,693.3867" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="265.8" x2="265.8" y1="741.3492" y2="762.9492"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="265.8" x2="443.4" y1="762.9492" y2="762.9492"/><polygon fill="#A80036" points="431.4,758.1492,443.4,762.9492,431.4,767.7492,436.2,762.9492" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="649.8" x2="649.8" y1="741.3492" y2="762.9492"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="649.8" x2="472.2" y1="762.9492" y2="762.9492"/><polygon fill="#A80036" points="484.2,758.1492,472.2,762.9492,484.2,767.7492,479.4,762.9492" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="254.1" x2="254.1" y1="870.9493" y2="900.2321"/><polygon fill="#A80036" points="249.3,888.2321,254.1,900.2321,258.9,888.2321,254.1,893.0321" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="438.3" x2="452.7" y1="856.5493" y2="856.5493"/><polygon fill="#A80036" points="447.9,908.6133,452.7,920.6133,457.5,908.6133,452.7,913.4133" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="452.7" x2="452.7" y1="856.5493" y2="979.3946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="452.7" x2="268.5" y1="979.3946" y2="979.3946"/><polygon fill="#A80036" points="280.5,974.5946,268.5,979.3946,280.5,984.1946,275.7,979.3946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="254.1" x2="254.1" y1="940.9946" y2="964.9946"/><polygon fill="#A80036" points="249.3,952.9946,254.1,964.9946,258.9,952.9946,254.1,957.7946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="286.8" x2="254.1" y1="815.7493" y2="815.7493"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="254.1" x2="254.1" y1="815.7493" y2="842.1493"/><polygon fill="#A80036" points="249.3,830.1493,254.1,842.1493,258.9,830.1493,254.1,834.9493" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="628.8" x2="661.5" y1="815.7493" y2="815.7493"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="661.5" x2="661.5" y1="815.7493" y2="842.1493"/><polygon fill="#A80036" points="656.7,830.1493,661.5,842.1493,666.3,830.1493,661.5,834.9493" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="254.1" x2="254.1" y1="993.7946" y2="1015.3946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="254.1" x2="443.4" y1="1015.3946" y2="1015.3946"/><polygon fill="#A80036" points="431.4,1010.5946,443.4,1015.3946,431.4,1020.1946,436.2,1015.3946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="661.5" x2="661.5" y1="882.9118" y2="1015.3946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="661.5" x2="472.2" y1="1015.3946" y2="1015.3946"/><polygon fill="#A80036" points="484.2,1010.5946,472.2,1015.3946,484.2,1020.1946,479.4,1015.3946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="777.3492" y2="801.3493"/><polygon fill="#A80036" points="453,789.3493,457.8,801.3493,462.6,789.3493,457.8,794.1493" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="600.6" x2="600.6" y1="1161.4096" y2="1185.4096"/><polygon fill="#A80036" points="595.8,1173.4096,600.6,1185.4096,605.4,1173.4096,600.6,1178.2096" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="600.6" x2="600.6" y1="1226.1721" y2="1250.1721"/><polygon fill="#A80036" points="595.8,1238.1721,600.6,1250.1721,605.4,1238.1721,600.6,1242.9721" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="201.6" x2="201.6" y1="1082.5946" y2="1120.6471"/><polygon fill="#A80036" points="196.8,1108.6471,201.6,1120.6471,206.4,1108.6471,201.6,1113.4471" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="201.6" x2="201.6" y1="1161.4096" y2="1314.9346"/><polygon fill="#A80036" points="196.8,1302.9346,201.6,1314.9346,206.4,1302.9346,201.6,1307.7346" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="600.6" x2="600.6" y1="1082.5946" y2="1120.6471"/><polygon fill="#A80036" points="595.8,1108.6471,600.6,1120.6471,605.4,1108.6471,600.6,1113.4471" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="600.6" x2="600.6" y1="1290.9346" y2="1314.9346"/><polygon fill="#A80036" points="595.8,1302.9346,600.6,1314.9346,605.4,1302.9346,600.6,1307.7346" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="361.8" x2="444" y1="1068.1946" y2="1068.1946"/><polygon fill="#A80036" points="432,1063.3946,444,1068.1946,432,1072.9946,436.8,1068.1946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1029.7946" y2="1035.7946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="201.6" y1="1035.7946" y2="1035.7946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="201.6" x2="201.6" y1="1035.7946" y2="1053.7946"/><polygon fill="#A80036" points="196.8,1041.7946,201.6,1053.7946,206.4,1041.7946,201.6,1046.5946" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="757.2" x2="856.8" y1="1068.1946" y2="1068.1946"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="856.8" x2="856.8" y1="1068.1946" y2="1314.9346"/><polygon fill="#A80036" points="852,1302.9346,856.8,1314.9346,861.6,1302.9346,856.8,1307.7346" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="201.6" x2="856.8" y1="1314.9346" y2="1314.9346"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1437.7799" y2="1461.7799"/><polygon fill="#A80036" points="453,1449.7799,457.8,1461.7799,462.6,1449.7799,457.8,1454.5799" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1502.5424" y2="1544.5424"/><polygon fill="#A80036" points="453,1532.5424,457.8,1544.5424,462.6,1532.5424,457.8,1537.3424" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1585.3049" y2="1609.3049"/><polygon fill="#A80036" points="453,1597.3049,457.8,1609.3049,462.6,1597.3049,457.8,1602.1049" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1367.7346" y2="1397.0174"/><polygon fill="#A80036" points="453,1385.0174,457.8,1397.0174,462.6,1385.0174,457.8,1389.8174" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="642" x2="723" y1="1353.3346" y2="1353.3346"/><polygon fill="#A80036" points="718.2,1511.5424,723,1523.5424,727.8,1511.5424,723,1516.3424" style="stroke: #A80036; stroke-width: 1.8000000715255737;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="723" x2="723" y1="1353.3346" y2="1688.4674"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="723" x2="472.2" y1="1688.4674" y2="1688.4674"/><polygon fill="#A80036" points="484.2,1683.6674,472.2,1688.4674,484.2,1693.2675,479.4,1688.4674" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1650.0674" y2="1674.0674"/><polygon fill="#A80036" points="453,1662.0674,457.8,1674.0674,462.6,1662.0674,457.8,1666.8674" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1314.9346" y2="1338.9346"/><polygon fill="#A80036" points="453,1326.9346,457.8,1338.9346,462.6,1326.9346,457.8,1331.7346" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1702.8675" y2="1726.8675"/><polygon fill="#A80036" points="453,1714.8675,457.8,1726.8675,462.6,1714.8675,457.8,1719.6675" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="603.2684" y2="659.7867"/><polygon fill="#A80036" points="453,647.7867,457.8,659.7867,462.6,647.7867,457.8,652.5867" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1767.63" y2="1806.03"/><polygon fill="#A80036" points="453,1794.03,457.8,1806.03,462.6,1794.03,457.8,1798.83" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="1846.7925" y2="1870.7925"/><polygon fill="#A80036" points="453,1858.7925,457.8,1870.7925,462.6,1858.7925,457.8,1863.5925" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="473.7434" y2="497.7434"/><polygon fill="#A80036" points="453,485.7434,457.8,497.7434,462.6,485.7434,457.8,490.5434" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.8000000715255737;" x1="457.8" x2="457.8" y1="428.1434" y2="466.5434"/><polygon fill="#A80036" points="453,454.5434,457.8,466.5434,462.6,454.5434,457.8,459.3434" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><!--
@startuml
title Алгоритм обновления состояния \nоператора

start

:Получение сообщения FullBuddyList;

partition "Добавление задач в очередь" {
    :Добавление задачи обновления \nсписка логинов и номеров в кэше;
    :Добавление задачи обновление \nсостояния оператора;
    :Добавление задачи удаление \nотсутствующих операторв из кэша;
}

fork
:Получение задач из очреди;

:Обновление списка логинов у операторов;

partition "Обновление состояния у операторов" {
    if (Оператор онлайн?) then (да)
        :Изменение статуса оператора на "online";
    else (нет)
        :Изменение статуса оператора на "offline";
    endif
    if (Оператор ранее уже был сохранен в кэше?) then (да)
        if (Статус оператора отличается от сохраненого?) then (да)
            :Обновление статуса;
        endif
    else (нет)
        :Сохранение нового состояния у оператора;
    endif

    if (Оператор перешел в состояние wrapup?) then (да)
        :Сохранение временной метки в Redis;
    elseif (Оператор вышел из состояния wrapup?) then (да)
        :Удаление временной метки из Redis;
        :Подсчет времени нахождения в состоянии wrapup;
        :Сохранение полученных данных в ns_acw;
    endif

    if (Статус оператора отличается от сохраненого?) then (да)
        :Подсчет времени нахождения в предыдущем состоянии;
        :Сохранение полученных данных в ns_agent_status;
        :Подсчет времени нахождения в предыдущем подсостоянии;
        :Сохранение полученных данных в ns_agent_sub_status;
    endif

    :Отправка изменений в Redis;
}

:Удаление отсутсвующих операторов;

stop


@enduml

PlantUML version 1.2018.11(Sat Sep 22 21:43:53 YEKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Linux
OS Version: 4.15.0-45-generic
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>