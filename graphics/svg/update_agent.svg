<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1402px" preserveAspectRatio="none" style="width:917px;height:1402px;" version="1.1" viewBox="0 0 917 1402" width="917px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cnjeq5565n7q" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="458" cy="20" fill="#000000" filter="url(#f1cnjeq5565n7q)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="251" x="332.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="231" x="342.5" y="71.1387">Получение сообщения FullBuddyList</text><rect fill="#FFFFFF" filter="url(#f1cnjeq5565n7q)" height="232.1094" style="stroke: #000000; stroke-width: 2.0;" width="276" x="320" y="94.7705"/><path d="M545,95.7705 L545,104.0674 L535,114.0674 L320,114.0674 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="215" x="323" y="108.7656">Добавление задач в очередь</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="242" x="337" y="131.0674"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="212" x="347" y="152.2061">Добавление задачи обновления</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="222" x="347" y="166.1748">списка логинов и номеров в кэше</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="237" x="339.5" y="199.0049"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="213" x="349.5" y="220.1436">Добавление задачи обновление</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="146" x="349.5" y="234.1123">состояния оператора</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="256" x="330" y="266.9424"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="197" x="340" y="288.0811">Добавление задачи удаление</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="236" x="340" y="302.0498">отсутствующих операторв из кэша</text><rect fill="#000000" filter="url(#f1cnjeq5565n7q)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="896" x="10" y="346.8799"/><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="203" x="356.5" y="372.8799"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="183" x="366.5" y="394.0186">Получение задач из очреди</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="299" x="308.5" y="426.8486"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="279" x="318.5" y="447.9873">Обновление списка логинов у операторов</text><rect fill="#FFFFFF" filter="url(#f1cnjeq5565n7q)" height="809.5933" style="stroke: #000000; stroke-width: 2.0;" width="868" x="24" y="471.6191"/><path d="M309,472.6191 L309,480.916 L299,490.916 L24,490.916 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="275" x="27" y="485.6143">Обновление состояния у операторов</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="403,507.916,513,507.916,525,519.916,513,531.916,403,531.916,391,519.916,403,507.916" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="403" y="523.7241">Оператор онлайн?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="376" y="517.3218">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="525" y="517.3218">нет</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="300" x="148" y="541.916"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="280" x="158" y="563.0547">Изменение статуса оператора на "online"</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="300" x="468" y="541.916"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="280" x="478" y="563.0547">Изменение статуса оператора на "offline"</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="458,581.8848,470,593.8848,458,605.8848,446,593.8848,458,581.8848" style="stroke: #383838; stroke-width: 1.5;"/><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="327.5,625.8848,588.5,625.8848,600.5,637.8848,588.5,649.8848,327.5,649.8848,315.5,637.8848,327.5,625.8848" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="261" x="327.5" y="641.6929">Оператор ранее уже был сохранен в кэше?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="300.5" y="635.2905">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="600.5" y="635.2905">нет</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="157" x="209.75" y="708.2871"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="137" x="219.75" y="729.4258">Обновление статуса</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="146.75,659.8848,429.75,659.8848,441.75,671.8848,429.75,683.8848,146.75,683.8848,134.75,671.8848,146.75,659.8848" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="292.25" y="694.0952">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="283" x="146.75" y="675.6929">Статус оператора отличается от сохраненого?</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="288.25,762.2559,300.25,774.2559,288.25,786.2559,276.25,774.2559,288.25,762.2559" style="stroke: #383838; stroke-width: 1.5;"/><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="308" x="473.75" y="659.8848"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="288" x="483.75" y="681.0234">Сохранение нового состояния у оператора</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="458,792.2559,470,804.2559,458,816.2559,446,804.2559,458,792.2559" style="stroke: #383838; stroke-width: 1.5;"/><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="46.5,836.2559,289.5,836.2559,301.5,848.2559,289.5,860.2559,46.5,860.2559,34.5,848.2559,46.5,836.2559" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="172" y="870.4663">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="243" x="46.5" y="852.064">Оператор перешел в состояние wrapup?</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="268" x="34" y="891.9663"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="248" x="44" y="913.105">Сохранение временной метки в Redis</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="458.5,836.2559,695.5,836.2559,707.5,848.2559,695.5,860.2559,458.5,860.2559,446.5,848.2559,458.5,836.2559" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="581" y="870.4663">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="237" x="458.5" y="852.064">Оператор вышел из состояния wrapup?</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="261" x="446.5" y="891.9663"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="241" x="456.5" y="913.105">Удаление временной метки из Redis</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="510" x="322" y="945.9351"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="490" x="332" y="967.0737">Подсчет времени нахождения в состоянии wrapup и сохранение в ns_acw</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="508" x="204" y="1068.3062"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="488" x="214" y="1089.4448">Подсчет времени нахождения в предыдущем состоянии и подсостоянии</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="497" x="209.5" y="1137.2749"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="477" x="219.5" y="1158.4136">Сохранение полученных данных в ns_agent_status и ns_agent_sub_status</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="316.5,1019.9038,599.5,1019.9038,611.5,1031.9038,599.5,1043.9038,316.5,1043.9038,304.5,1031.9038,316.5,1019.9038" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="462" y="1054.1143">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="283" x="316.5" y="1035.7119">Статус оператора отличается от сохраненого?</text><polygon fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" points="458,1191.2437,470,1203.2437,458,1215.2437,446,1203.2437,458,1191.2437" style="stroke: #383838; stroke-width: 1.5;"/><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="209" x="353.5" y="1235.2437"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="189" x="363.5" y="1256.3823">Отправка изменений в Redis</text><rect fill="#F8F8F8" filter="url(#f1cnjeq5565n7q)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="266" x="325" y="1301.2124"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="246" x="335" y="1322.3511">Удаление отсутсвующих операторов</text><ellipse cx="458" cy="1365.1812" fill="none" filter="url(#f1cnjeq5565n7q)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="458.5" cy="1365.6812" fill="#000000" filter="url(#f1cnjeq5565n7q)" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#000000" filter="url(#f1cnjeq5565n7q)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="896" x="10" y="1385.1812"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="30" y2="50"/><polygon fill="#383838" points="454,40,458,50,462,40,458,44" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="179.0049" y2="199.0049"/><polygon fill="#383838" points="454,189.0049,458,199.0049,462,189.0049,458,193.0049" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="246.9424" y2="266.9424"/><polygon fill="#383838" points="454,256.9424,458,266.9424,462,256.9424,458,260.9424" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="83.9688" y2="131.0674"/><polygon fill="#383838" points="454,121.0674,458,131.0674,462,121.0674,458,125.0674" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="406.8486" y2="426.8486"/><polygon fill="#383838" points="454,416.8486,458,426.8486,462,416.8486,458,420.8486" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="391" x2="298" y1="519.916" y2="519.916"/><line style="stroke: #383838; stroke-width: 1.5;" x1="298" x2="298" y1="519.916" y2="541.916"/><polygon fill="#383838" points="294,531.916,298,541.916,302,531.916,298,535.916" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="525" x2="618" y1="519.916" y2="519.916"/><line style="stroke: #383838; stroke-width: 1.5;" x1="618" x2="618" y1="519.916" y2="541.916"/><polygon fill="#383838" points="614,531.916,618,541.916,622,531.916,618,535.916" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="298" x2="298" y1="575.8848" y2="593.8848"/><line style="stroke: #383838; stroke-width: 1.5;" x1="298" x2="446" y1="593.8848" y2="593.8848"/><polygon fill="#383838" points="436,589.8848,446,593.8848,436,597.8848,440,593.8848" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="618" x2="618" y1="575.8848" y2="593.8848"/><line style="stroke: #383838; stroke-width: 1.5;" x1="618" x2="470" y1="593.8848" y2="593.8848"/><polygon fill="#383838" points="480,589.8848,470,593.8848,480,597.8848,476,593.8848" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="288.25" x2="288.25" y1="683.8848" y2="708.2871"/><polygon fill="#383838" points="284.25,698.2871,288.25,708.2871,292.25,698.2871,288.25,702.2871" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="441.75" x2="453.75" y1="671.8848" y2="671.8848"/><polygon fill="#383838" points="449.75,715.2715,453.75,725.2715,457.75,715.2715,453.75,719.2715" style="stroke: #383838; stroke-width: 1.5;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="453.75" x2="453.75" y1="671.8848" y2="774.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="453.75" x2="300.25" y1="774.2559" y2="774.2559"/><polygon fill="#383838" points="310.25,770.2559,300.25,774.2559,310.25,778.2559,306.25,774.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="288.25" x2="288.25" y1="742.2559" y2="762.2559"/><polygon fill="#383838" points="284.25,752.2559,288.25,762.2559,292.25,752.2559,288.25,756.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="315.5" x2="288.25" y1="637.8848" y2="637.8848"/><line style="stroke: #383838; stroke-width: 1.5;" x1="288.25" x2="288.25" y1="637.8848" y2="659.8848"/><polygon fill="#383838" points="284.25,649.8848,288.25,659.8848,292.25,649.8848,288.25,653.8848" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="600.5" x2="627.75" y1="637.8848" y2="637.8848"/><line style="stroke: #383838; stroke-width: 1.5;" x1="627.75" x2="627.75" y1="637.8848" y2="659.8848"/><polygon fill="#383838" points="623.75,649.8848,627.75,659.8848,631.75,649.8848,627.75,653.8848" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="288.25" x2="288.25" y1="786.2559" y2="804.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="288.25" x2="446" y1="804.2559" y2="804.2559"/><polygon fill="#383838" points="436,800.2559,446,804.2559,436,808.2559,440,804.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="627.75" x2="627.75" y1="693.8535" y2="804.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="627.75" x2="470" y1="804.2559" y2="804.2559"/><polygon fill="#383838" points="480,800.2559,470,804.2559,480,808.2559,476,804.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="605.8848" y2="625.8848"/><polygon fill="#383838" points="454,615.8848,458,625.8848,462,615.8848,458,619.8848" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="577" x2="577" y1="925.9351" y2="945.9351"/><polygon fill="#383838" points="573,935.9351,577,945.9351,581,935.9351,577,939.9351" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="168" x2="168" y1="860.2559" y2="891.9663"/><polygon fill="#383838" points="164,881.9663,168,891.9663,172,881.9663,168,885.9663" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="168" x2="168" y1="925.9351" y2="999.9038"/><polygon fill="#383838" points="164,989.9038,168,999.9038,172,989.9038,168,993.9038" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="577" x2="577" y1="860.2559" y2="891.9663"/><polygon fill="#383838" points="573,881.9663,577,891.9663,581,881.9663,577,885.9663" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="577" x2="577" y1="979.9038" y2="999.9038"/><polygon fill="#383838" points="573,989.9038,577,999.9038,581,989.9038,577,993.9038" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="301.5" x2="446.5" y1="848.2559" y2="848.2559"/><polygon fill="#383838" points="436.5,844.2559,446.5,848.2559,436.5,852.2559,440.5,848.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="816.2559" y2="821.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="168" y1="821.2559" y2="821.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="168" x2="168" y1="821.2559" y2="836.2559"/><polygon fill="#383838" points="164,826.2559,168,836.2559,172,826.2559,168,830.2559" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="707.5" x2="867" y1="848.2559" y2="848.2559"/><line style="stroke: #383838; stroke-width: 1.5;" x1="867" x2="867" y1="848.2559" y2="999.9038"/><polygon fill="#383838" points="863,989.9038,867,999.9038,871,989.9038,867,993.9038" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="168" x2="867" y1="999.9038" y2="999.9038"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1102.2749" y2="1137.2749"/><polygon fill="#383838" points="454,1127.2749,458,1137.2749,462,1127.2749,458,1131.2749" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1043.9038" y2="1068.3062"/><polygon fill="#383838" points="454,1058.3062,458,1068.3062,462,1058.3062,458,1062.3062" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="611.5" x2="722" y1="1031.9038" y2="1031.9038"/><polygon fill="#383838" points="718,1109.7749,722,1119.7749,726,1109.7749,722,1113.7749" style="stroke: #383838; stroke-width: 1.5;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="722" x2="722" y1="1031.9038" y2="1203.2437"/><line style="stroke: #383838; stroke-width: 1.5;" x1="722" x2="470" y1="1203.2437" y2="1203.2437"/><polygon fill="#383838" points="480,1199.2437,470,1203.2437,480,1207.2437,476,1203.2437" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1171.2437" y2="1191.2437"/><polygon fill="#383838" points="454,1181.2437,458,1191.2437,462,1181.2437,458,1185.2437" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="999.9038" y2="1019.9038"/><polygon fill="#383838" points="454,1009.9038,458,1019.9038,462,1009.9038,458,1013.9038" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1215.2437" y2="1235.2437"/><polygon fill="#383838" points="454,1225.2437,458,1235.2437,462,1225.2437,458,1229.2437" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="460.8174" y2="507.916"/><polygon fill="#383838" points="454,497.916,458,507.916,462,497.916,458,501.916" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1269.2124" y2="1301.2124"/><polygon fill="#383838" points="454,1291.2124,458,1301.2124,462,1291.2124,458,1295.2124" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="1335.1812" y2="1355.1812"/><polygon fill="#383838" points="454,1345.1812,458,1355.1812,462,1345.1812,458,1349.1812" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="352.8799" y2="372.8799"/><polygon fill="#383838" points="454,362.8799,458,372.8799,462,362.8799,458,366.8799" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="458" x2="458" y1="314.8799" y2="346.8799"/><polygon fill="#383838" points="454,336.8799,458,346.8799,462,336.8799,458,340.8799" style="stroke: #383838; stroke-width: 1.0;"/><!--
@startuml

skinparam {
    monochrome true
}

start

:Получение сообщения FullBuddyList;

partition "Добавление задач в очередь" {
    :Добавление задачи обновления \nсписка логинов и номеров в кэше;
    :Добавление задачи обновление \nсостояния оператора;
    :Добавление задачи удаление \nотсутствующих операторв из кэша;
}

fork
:Получение задач из очреди;

:Обновление списка логинов у операторов;

partition "Обновление состояния у операторов" {
    if (Оператор онлайн?) then (да)
        :Изменение статуса оператора на "online";
    else (нет)
        :Изменение статуса оператора на "offline";
    endif
    if (Оператор ранее уже был сохранен в кэше?) then (да)
        if (Статус оператора отличается от сохраненого?) then (да)
            :Обновление статуса;
        endif
    else (нет)
        :Сохранение нового состояния у оператора;
    endif

    if (Оператор перешел в состояние wrapup?) then (да)
        :Сохранение временной метки в Redis;
    elseif (Оператор вышел из состояния wrapup?) then (да)
        :Удаление временной метки из Redis;
        :Подсчет времени нахождения в состоянии wrapup и сохранение в ns_acw;
    endif

    if (Статус оператора отличается от сохраненого?) then (да)
        :Подсчет времени нахождения в предыдущем состоянии и подсостоянии;
        :Сохранение полученных данных в ns_agent_status и ns_agent_sub_status;
    endif

    :Отправка изменений в Redis;
}

:Удаление отсутсвующих операторов;

stop


@enduml

PlantUML version 1.2018.11(Sat Sep 22 21:43:53 YEKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Linux
OS Version: 4.15.0-45-generic
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>