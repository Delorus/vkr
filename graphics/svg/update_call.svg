<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1383px" preserveAspectRatio="none" style="width:1054px;height:1383px;" version="1.1" viewBox="0 0 1054 1383" width="1054px" zoomAndPan="magnify"><defs><filter height="300%" id="fgi9i9r4okz6l" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="526.5" cy="20" fill="#000000" filter="url(#fgi9i9r4okz6l)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="171" x="441" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="451" y="71.1387">Получение сообщения</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="145" x="451" y="85.1074">FullCallList/ShortCallList</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="263" x="395" y="117.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="243" x="405" y="139.0762">Сериалиация в структуру FullCallsList</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="232" x="410.5" y="171.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="212" x="420.5" y="193.0449">Отправка сообщения в очередь</text><rect fill="#000000" filter="url(#fgi9i9r4okz6l)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1033" x="10" y="225.875"/><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="246" x="312.875" y="251.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="226" x="322.875" y="273.0137">Получение сообщения из очереди</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="339.875,305.8438,531.875,305.8438,543.875,317.8438,531.875,329.8438,339.875,329.8438,327.875,317.8438,339.875,305.8438" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="192" x="339.875" y="321.6519">Состояние звонка - завершено?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="312.875" y="315.2495">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="543.875" y="315.2495">нет</text><rect fill="#FFFFFF" filter="url(#fgi9i9r4okz6l)" height="242.1719" style="stroke: #000000; stroke-width: 2.0;" width="312" x="44" y="388.2461"/><path d="M200,389.2461 L200,397.543 L190,407.543 L44,407.543 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="47" y="402.2412">Завершение звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="237" x="81.5" y="424.543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="213" x="91.5" y="445.6816">Установка времени завершения</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="110" x="91.5" y="459.6504">у каждого плеча</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="292" x="54" y="507.4805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="272" x="64" y="528.6191">Установка времени завершения у звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="290" x="55" y="576.4492"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="270" x="65" y="597.5879">Перевод звонка в состояние "завершен"</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="188" x="106" y="665.418"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="116" y="686.5566">Удаление звонка из кэша</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="273" x="63.5" y="734.3867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="253" x="73.5" y="755.5254">Преобразование в формат данных БД</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="131" x="134.5" y="789.9844"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="144.5" y="811.123">Сохранение в БД</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="137,339.8438,263,339.8438,275,351.8438,263,363.8438,137,363.8438,125,351.8438,137,339.8438" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="204" y="374.0542">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="137" y="355.6519">Звонок есть в кэше?</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="200,848.3555,212,860.3555,200,872.3555,188,860.3555,200,848.3555" style="stroke: #383838; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fgi9i9r4okz6l)" height="430.1406" style="stroke: #000000; stroke-width: 2.0;" width="621" x="398" y="339.8438"/><path d="M534,340.8438 L534,349.1406 L524,359.1406 L398,359.1406 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="401" y="353.8389">Создание звонка</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="608.75,376.1406,734.75,376.1406,746.75,388.1406,734.75,400.1406,608.75,400.1406,596.75,388.1406,608.75,376.1406" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="608.75" y="391.9487">Звонок есть в кэше?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="581.75" y="385.5464">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="21" x="746.75" y="385.5464">нет</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="207" x="418" y="410.1406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="187" x="428" y="431.2793">Обновление состояние плеч</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="160" x="742" y="410.1406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="752" y="431.2793">Создание новых плеч</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="207" x="718.5" y="479.1094"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="187" x="728.5" y="500.248">Обновление состояние плеч</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="195" x="724.5" y="548.0781"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="175" x="734.5" y="569.2168">Определение типа звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="354" x="645" y="617.0469"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="334" x="655" y="638.1855">Создание нового звонка соответствующего типа</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="189" x="727.5" y="686.0156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="169" x="737.5" y="707.1543">Добавление звонка в кэш</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="671.75,725.9844,683.75,737.9844,671.75,749.9844,659.75,737.9844,671.75,725.9844" style="stroke: #383838; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fgi9i9r4okz6l)" height="240.7227" style="stroke: #000000; stroke-width: 2.0;" width="248" x="553.75" y="791.6133"/><path d="M708.75,792.6133 L708.75,800.9102 L698.75,810.9102 L553.75,810.9102 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="556.75" y="805.6084">Обновление звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="151" x="596.25" y="827.9102"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="131" x="606.25" y="849.0488">Обновление данных</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="196" x="573.75" y="942.3672"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="176" x="583.75" y="963.5059">Сохранение звонка в Redis</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="579.75,892.3555,763.75,892.3555,775.75,905.1602,763.75,917.9648,579.75,917.9648,567.75,905.1602,579.75,892.3555" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="675.75" y="928.1753">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="579.75" y="902.5659">Звонка нет в Redis &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="184" x="579.75" y="915.3706">звонок прикреплен к проекту?</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="671.75,996.3359,683.75,1008.3359,671.75,1020.3359,659.75,1008.3359,671.75,996.3359" style="stroke: #383838; stroke-width: 1.5;"/><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="151" x="596.25" y="1100.7383"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="131" x="606.25" y="1121.877">Завершение звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="133" x="605.25" y="1154.707"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="113" x="615.25" y="1175.8457">Создание звонка</text><rect fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #383838; stroke-width: 1.5;" width="189" x="577.25" y="1208.6758"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="169" x="587.25" y="1229.8145">Добавление звонка в кэш</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="565.75,1052.3359,777.75,1052.3359,789.75,1064.3359,777.75,1076.3359,565.75,1076.3359,553.75,1064.3359,565.75,1052.3359" style="stroke: #383838; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="15" x="675.75" y="1086.5464">да</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="212" x="565.75" y="1068.144">Прикрепленный проект изменился?</text><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="671.75,1262.6445,683.75,1274.6445,671.75,1286.6445,659.75,1274.6445,671.75,1262.6445" style="stroke: #383838; stroke-width: 1.5;"/><polygon fill="#F8F8F8" filter="url(#fgi9i9r4okz6l)" points="435.875,1292.6445,447.875,1304.6445,435.875,1316.6445,423.875,1304.6445,435.875,1292.6445" style="stroke: #383838; stroke-width: 1.5;"/><ellipse cx="435.875" cy="1346.6445" fill="none" filter="url(#fgi9i9r4okz6l)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="436.375" cy="1347.1445" fill="#000000" filter="url(#fgi9i9r4okz6l)" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#000000" filter="url(#fgi9i9r4okz6l)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1033" x="10" y="1366.6445"/><line style="stroke: #383838; stroke-width: 1.5;" x1="526.5" x2="526.5" y1="30" y2="50"/><polygon fill="#383838" points="522.5,40,526.5,50,530.5,40,526.5,44" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="526.5" x2="526.5" y1="97.9375" y2="117.9375"/><polygon fill="#383838" points="522.5,107.9375,526.5,117.9375,530.5,107.9375,526.5,111.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="526.5" x2="526.5" y1="151.9063" y2="171.9063"/><polygon fill="#383838" points="522.5,161.9063,526.5,171.9063,530.5,161.9063,526.5,165.9063" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="472.4805" y2="507.4805"/><polygon fill="#383838" points="196,497.4805,200,507.4805,204,497.4805,200,501.4805" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="541.4492" y2="576.4492"/><polygon fill="#383838" points="196,566.4492,200,576.4492,204,566.4492,200,570.4492" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="610.418" y2="665.418"/><polygon fill="#383838" points="196,655.418,200,665.418,204,655.418,200,659.418" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="699.3867" y2="734.3867"/><polygon fill="#383838" points="196,724.3867,200,734.3867,204,724.3867,200,728.3867" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="768.3555" y2="789.9844"/><polygon fill="#383838" points="196,779.9844,200,789.9844,204,779.9844,200,783.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="363.8438" y2="424.543"/><polygon fill="#383838" points="196,414.543,200,424.543,204,414.543,200,418.543" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="275" x2="366" y1="351.8438" y2="351.8438"/><polygon fill="#383838" points="362,602.7852,366,612.7852,370,602.7852,366,606.7852" style="stroke: #383838; stroke-width: 1.5;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="366" x2="366" y1="351.8438" y2="860.3555"/><line style="stroke: #383838; stroke-width: 1.5;" x1="366" x2="212" y1="860.3555" y2="860.3555"/><polygon fill="#383838" points="222,856.3555,212,860.3555,222,864.3555,218,860.3555" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="823.9531" y2="848.3555"/><polygon fill="#383838" points="196,838.3555,200,848.3555,204,838.3555,200,842.3555" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="444.1094" y2="479.1094"/><polygon fill="#383838" points="818,469.1094,822,479.1094,826,469.1094,822,473.1094" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="513.0781" y2="548.0781"/><polygon fill="#383838" points="818,538.0781,822,548.0781,826,538.0781,822,542.0781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="582.0469" y2="617.0469"/><polygon fill="#383838" points="818,607.0469,822,617.0469,826,607.0469,822,611.0469" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="651.0156" y2="686.0156"/><polygon fill="#383838" points="818,676.0156,822,686.0156,826,676.0156,822,680.0156" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="596.75" x2="521.5" y1="388.1406" y2="388.1406"/><line style="stroke: #383838; stroke-width: 1.5;" x1="521.5" x2="521.5" y1="388.1406" y2="410.1406"/><polygon fill="#383838" points="517.5,400.1406,521.5,410.1406,525.5,400.1406,521.5,404.1406" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="746.75" x2="822" y1="388.1406" y2="388.1406"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="388.1406" y2="410.1406"/><polygon fill="#383838" points="818,400.1406,822,410.1406,826,400.1406,822,404.1406" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="521.5" x2="521.5" y1="444.1094" y2="737.9844"/><line style="stroke: #383838; stroke-width: 1.5;" x1="521.5" x2="659.75" y1="737.9844" y2="737.9844"/><polygon fill="#383838" points="649.75,733.9844,659.75,737.9844,649.75,741.9844,653.75,737.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="822" y1="719.9844" y2="737.9844"/><line style="stroke: #383838; stroke-width: 1.5;" x1="822" x2="683.75" y1="737.9844" y2="737.9844"/><polygon fill="#383838" points="693.75,733.9844,683.75,737.9844,693.75,741.9844,689.75,737.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="917.9648" y2="942.3672"/><polygon fill="#383838" points="667.75,932.3672,671.75,942.3672,675.75,932.3672,671.75,936.3672" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="775.75" x2="787.75" y1="905.1602" y2="905.1602"/><polygon fill="#383838" points="783.75,948.9492,787.75,958.9492,791.75,948.9492,787.75,952.9492" style="stroke: #383838; stroke-width: 1.5;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="787.75" x2="787.75" y1="905.1602" y2="1008.3359"/><line style="stroke: #383838; stroke-width: 1.5;" x1="787.75" x2="683.75" y1="1008.3359" y2="1008.3359"/><polygon fill="#383838" points="693.75,1004.3359,683.75,1008.3359,693.75,1012.3359,689.75,1008.3359" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="976.3359" y2="996.3359"/><polygon fill="#383838" points="667.75,986.3359,671.75,996.3359,675.75,986.3359,671.75,990.3359" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="861.8789" y2="892.3555"/><polygon fill="#383838" points="667.75,882.3555,671.75,892.3555,675.75,882.3555,671.75,886.3555" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="749.9844" y2="827.9102"/><polygon fill="#383838" points="667.75,817.9102,671.75,827.9102,675.75,817.9102,671.75,821.9102" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1134.707" y2="1154.707"/><polygon fill="#383838" points="667.75,1144.707,671.75,1154.707,675.75,1144.707,671.75,1148.707" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1188.6758" y2="1208.6758"/><polygon fill="#383838" points="667.75,1198.6758,671.75,1208.6758,675.75,1198.6758,671.75,1202.6758" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1076.3359" y2="1100.7383"/><polygon fill="#383838" points="667.75,1090.7383,671.75,1100.7383,675.75,1090.7383,671.75,1094.7383" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="789.75" x2="801.75" y1="1064.3359" y2="1064.3359"/><polygon fill="#383838" points="797.75,1161.6914,801.75,1171.6914,805.75,1161.6914,801.75,1165.6914" style="stroke: #383838; stroke-width: 1.5;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="801.75" x2="801.75" y1="1064.3359" y2="1274.6445"/><line style="stroke: #383838; stroke-width: 1.5;" x1="801.75" x2="683.75" y1="1274.6445" y2="1274.6445"/><polygon fill="#383838" points="693.75,1270.6445,683.75,1274.6445,693.75,1278.6445,689.75,1274.6445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1242.6445" y2="1262.6445"/><polygon fill="#383838" points="667.75,1252.6445,671.75,1262.6445,675.75,1252.6445,671.75,1256.6445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1020.3359" y2="1052.3359"/><polygon fill="#383838" points="667.75,1042.3359,671.75,1052.3359,675.75,1042.3359,671.75,1046.3359" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="327.875" x2="200" y1="317.8438" y2="317.8438"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="317.8438" y2="339.8438"/><polygon fill="#383838" points="196,329.8438,200,339.8438,204,329.8438,200,333.8438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="543.875" x2="671.75" y1="317.8438" y2="317.8438"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="317.8438" y2="376.1406"/><polygon fill="#383838" points="667.75,366.1406,671.75,376.1406,675.75,366.1406,671.75,370.1406" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="200" y1="872.3555" y2="1304.6445"/><line style="stroke: #383838; stroke-width: 1.5;" x1="200" x2="423.875" y1="1304.6445" y2="1304.6445"/><polygon fill="#383838" points="413.875,1300.6445,423.875,1304.6445,413.875,1308.6445,417.875,1304.6445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="671.75" y1="1286.6445" y2="1304.6445"/><line style="stroke: #383838; stroke-width: 1.5;" x1="671.75" x2="447.875" y1="1304.6445" y2="1304.6445"/><polygon fill="#383838" points="457.875,1300.6445,447.875,1304.6445,457.875,1308.6445,453.875,1304.6445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="435.875" x2="435.875" y1="285.8438" y2="305.8438"/><polygon fill="#383838" points="431.875,295.8438,435.875,305.8438,439.875,295.8438,435.875,299.8438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="435.875" x2="435.875" y1="1316.6445" y2="1336.6445"/><polygon fill="#383838" points="431.875,1326.6445,435.875,1336.6445,439.875,1326.6445,435.875,1330.6445" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="435.875" x2="435.875" y1="231.875" y2="251.875"/><polygon fill="#383838" points="431.875,241.875,435.875,251.875,439.875,241.875,435.875,245.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.5;" x1="526.5" x2="526.5" y1="205.875" y2="225.875"/><polygon fill="#383838" points="522.5,215.875,526.5,225.875,530.5,215.875,526.5,219.875" style="stroke: #383838; stroke-width: 1.0;"/><!--
@startuml

skinparam {
    monochrome true
}

start

:Получение сообщения \nFullCallList/ShortCallList;

:Сериалиация в структуру FullCallsList;

:Отправка сообщения в очередь;

fork

:Получение сообщения из очереди;

if (Состояние звонка - завершено?) then (да)
    if (Звонок есть в кэше?) then (да)
        partition "Завершение звонка" {
            :Установка времени завершения \nу каждого плеча;
            :Установка времени завершения у звонка;
            :Перевод звонка в состояние "завершен";
        }
        :Удаление звонка из кэша;
        :Преобразование в формат данных БД;
        :Сохранение в БД;
    endif
else (нет)
    partition "Создание звонка" {
        if (Звонок есть в кэше?) then (да)
            :Обновление состояние плеч;
        else (нет)
            :Создание новых плеч;
            :Обновление состояние плеч;
            :Определение типа звонка;
            :Создание нового звонка соответствующего типа;
            :Добавление звонка в кэш;
        endif
    }
    partition "Обновление звонка" {
        :Обновление данных;
        if (Звонка нет в Redis && \nзвонок прикреплен к проекту?) then (да)
            :Сохранение звонка в Redis;
        endif
    }
    if (Прикрепленный проект изменился?) then (да)
        :Завершение звонка;
        :Создание звонка;
        :Добавление звонка в кэш;
    endif
endif

stop

@enduml

PlantUML version 1.2018.11(Sat Sep 22 21:43:53 YEKT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Linux
OS Version: 4.15.0-45-generic
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>