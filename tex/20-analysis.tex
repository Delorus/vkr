\chapter{Постановка задачи}
\label{cha:analysis}
%
% % В начале раздела  можно напомнить его цель
%

\section{Описание объекта автоматизации}

\subsection{Краткие сведения об объекте автоматизации}

\Abbrev{RRS}{Real-time report subsystem --- подсистема отчетов реального времени}
Объектом автоматизации сервиса для агрегирования информации по call-центру (далее RRS) является часть обязанностей супервизора,
связанных с наблюдением за текущим состоянием доверенных ему проектов и операторов.

\subsection{Сведения об условиях эксплуатации объекта автоматизации}

RRS является частью Naumen Contact Center.
NCC состоит из модулей и сервисов, каждый из которых выполняет свою функцию.
Обмен данными между компонентами NCC осуществляется по стандартным сетевым протоколам,
что позволяет физически размещать компоненты продукта на разных серверах.
Такая особенность архитектуры позволяет строить масштабируемые call-центры
для одновременного обслуживания массового количества вызовов.

NCC позволяет решать следующие основные задачи:
\begin{enumerate}
    \item организация проектов по обработке входящих обращений, в том числе:
    \begin{enumerate}
        \item обработка потока входящих телефонных вызовов;
        \item обработка потока входящих E-mail-сообщений;
        \item обработка потока входящих SMS-сообщений;
        \item обработка входящих мгновенных сообщений;
    \end{enumerate}
    \item организация исходящих проектов, включая:
    \begin{enumerate}
        \item автоматические исходящие обзвоны;
        \item E-mail рассылки;
    \end{enumerate}
    \item организация смешанных проектов, включая:
    \begin{enumerate}
        \item обработка обращений, поступивших по различным каналам связи одним и тем же оператором;
        \item обработка как входящих обращений, так и исходящих вызовов одним и тем же оператором;
    \end{enumerate}
    \item контроль работы операторов, в том числе:
    \begin{enumerate}
        \item осуществление записи разговоров;
        \item получение отчетности;
        \item управление качеством обработки вызовов.
    \end{enumerate}
\end{enumerate}

\Abbrev{PMS}{Project Management System --- система управления проектами}
Система управления проектами (PMS) представляет собой Web-ориентированную систему
управления проектами по обслуживанию обращений клиентов.
PMS включает в себя следующие основные функции:
\begin{enumerate}
    \item управление партнерами, которые выступают в качестве заказчиков на проекты по обслуживанию вызовов;
    \item формирование и ведение проектов, в том числе:
    \begin{enumerate}
        \item формирование состава участников;
        \item разработка сценариев обслуживания обращений;
        \item формирование заданий на обслуживание вызовов;
        \item контроль хода выполнения работ по проекту;
    \end{enumerate}
    \item использование встроенного программного телефона WebPhone;
    \item формирование отчетности и предоставление ее партнерам.
\end{enumerate}

\Define{NauCore}{Сервис шины управляющих сообщений, обеспечивает работу остальных сервисов NCC и их взаимодействие между собой}
PMS взаимодействует с другими сервисами через брокер сообщений NauCore посредством внутреннего протокола обмена сообщениям NCC.

NauCore запускается при загрузке операционной системы и выполняет следующие функции:
\begin{enumerate}
    \item осуществляет взаимодействие других компонентов NCC между собой;
    \item автоматически запускает и контролирует работу других телефонных сервисов. При аварийном завершении работы какого-либо сервиса пытается его перезапустить;
    \item предоставляет интерфейс управления сервисами, которые он контролирует:
    \begin{enumerate}
        \item web-интерфейс;
        \item командная строка;
    \end{enumerate}
    \item осуществляет ротацию журналов работы сервисов.
\end{enumerate}

Сервисы NauCore устанавливаются на каждый сервер NCC,
соединяются между собой и образуют общую шину обмена сообщениями.
При запуске каждый сервис NauCore автоматически запускает другие сервисы NCC
и обеспечивает их взаимодействие через общую шину.

\Abbrev{TCP}{Transmission Control Protocol --- протокол управления передачей}
NCC использует для связи компонент системы XML-over-TCP протокол.

\Abbrev{СУБД}{система управления базой данных}
\Define{PostgreSQL}{свободная объектно-реляционная система управления базами данных}
\Define{Oracle DB или Oracle RDBMS}{объектно-реляционная~система управления базами данных компании Oracle}
NCC в качестве базы данных использует общую СУБД, которой может быть либо PostgreSQL, либо Oracle DB.

RRS проектируется как отдельный сервис в NCC,
при этом задачу отображения данных берет на себя NCC PMS,
а сами данные нужно будет получать из NauCore\cite{Pup09}. %todo убрать

\section{Проблемы старых технологий}

\subsection{Недостатки существующей системы}

На текущий момент в NCC для агрегирования информации по call-центру используется проприетарный сервис
собственной разработки, написанный на Python 2.7 с использованием сетевого фрэймворка Twisted.
Причина, по которой от него решили отказаться, это задержки обновления данных в call-центрах,
с большим количеством одновременных операторов (более 900 человек).
Такие показатели не удовлятворяют заявленной производительности NCC. %todo производительности?
Так же, текущий сервис характеризуется высоким потреблением аппаратных ресурсов,
из-за чего требуется размешать его на выделенном сервере.

\subsection{Недостатки альтернативных решений}

Основным недостатком у альтернативных систем является то,
что обычно они являются частью комплексной системы и их не возможно,
либо очень проблематично интегрировать в NCC.
Еще одной особенностью, вытекающей из предыдущего пункта является то,
что сервисы NCC общаются посредством проприетарного протокола и для взаимодействия
с уже существующей технологией, ее пришлось бы значительно доработать.
Еще одной проблемой является то, что использование существующей технологии агрегирования информации
увеличивает издержки на тех. поддержку и сопровождение,
она осуществляется средствами Naumen и в случае сторонней разработки требовалось бы обращение
к их тех. поддержке, что накладывает как временные, так и финансовые издержки.
Система управления контактным центром NCC постоянно изменяется и совершенствуется,
в случае использования сторонней технологии станет проблематично вносить изменения во внешний,
по отношению к NCC, сервис, что приводит к торможению развития и возможно деградации возможностей NCC.
И последним недостатком существующих систем является возможные репутационные риски,
т.к. распространяться сервис будет под брендом разработчика
и если сторонняя технология не сможет удовлетворять стандартам Naumen,
повлиять на ее изменение он не сможет, либо это будет слишком трудозатратно.

\section{Требования к системе}

\subsection{Требования к системе в целом}

\subsubsection{Требование к структуре и функционированию системы} %todo возможно не стоит нумеровать

RRS должна включать в себя:
\begin{itemize}
    \item подсистему для хранения и доступа к нечувствительной ко времени информации;
    \item подсистему для хранения и предоставления быстрого доступа для чувствительной ко времени информации;
    \item подсистему взаимодействия с пользователем, которая включает в себя пользовательский веб-интерфейс, позволяющий просматривать полученные данные;
    \item подсистему для сбора данных по call-центру;
    \item файлы конфигурации для возможности настройки различных аспектов RRS\@.
\end{itemize}

RRS должна иметь доступ к сервисам NauCore и NCC PMS для обмена данными по TCP соединению.
Так же сервис агрегации данных должен быть выделен в отдельный микросервис для возможности размещение его на выделенном сервере с необходимыми для него ресурсами.

\Abbrev{API}{Application Programming Interface --- программный интерфейс приложения}
Нужно предоставить API для получение собираемых данных по call-центру,
с возможностью выборки и предобработки для статистических данных.

RRS должен функционировать исправно в штатном режиме.
В случае критической ошибки сервис должен падать,
т.к. такие ошибки могут испортить статистические данные и сломать различные метрики.
Перезапуск сервиса должен прозрачно обеспечить NauCore.
После старта RRS должен очистить чувствительные ко времени данные из кэша.

\Abbrev{БД}{база данных}
\Abbrev{ЦП}{центральный процессор}
Должна быть возможность наблюдать за текущим состоянием сервиса:
\begin{itemize}
    \item потребление оперативной памяти;
    \item количество запущенных системных потоков;
    \item количество подключений к БД;
    \item процент утилизации ЦП;
    \item количество используемых ядер ЦП.
\end{itemize}

\Define{Дамп памяти}{содержимое рабочей памяти одного процесса, ядра или всей операционной системы}
\Define{Трассировка}{отображение всех путей выполнения программы, с подсчетом времени выполнения}
Так же, должна быть возможность получить дамп памяти и трассировку для дальнейшего диагностирования в случае проблем.

\Define{Кэш}{специальная область в памяти предназначенная для временного хранения информации и для быстрого доступа к ним}
Для диагностирования проблем в логике работы сервиса потребуется возможность получать дамп внутреннего кэша.

\subsubsection{Требования к численности и квалификации пользователей системы} %todo возможно не стоит нумеровать

Пользователями системы являются прошедшие курсы и обученные супервизоры в call-центрах,
так же сервис могут использовать руководители отделов и партнеры,
в зависимости от настроенных прав в NCC PMS\@.

Количество пользователей одновременно использующих сервис ограничены
общими рекомендациями по NCC и зависит от конфигурации аппаратного обеспечения,
на котором размещена система.

\subsubsection{Требования к надежности}

RRS должен обеспечивать:
\begin{itemize}
    \item иметь необслуживаемое непрерывное функционирование компонентов и постоянную доступность сервиса;
    \item исключать искажения статистических данных в случаи внутренних ошибок сервиса;
\end{itemize}

Работоспособность RRS в случае потери энергоснабжения должна обеспечиваться за счет внешних по отношению к RRS средств.

\Abbrev{SSL}{Secure Sockets Layer --- уровень защищённых cокетов}
\subsubsection{Требования к безопасности}
\begin{itemize}
    \item RSS должен использовать внутренние механизмы регистрации и авторизации в NauCore;
    \item канал доступа к БД должен быть организован через SSL\@;
    \item доступ к диагностированию должен быть доступен только с локальной машины;
    \item в целом RRS должен быть размещен внутри защищенного контура без доступа к внешней сети, т.~к. передает данные в открытом текстовом виде;
\end{itemize}

\subsubsection{Требования к эргономике и технической эстетике}

Программное обеспечение RRS, с которым пользователь будет взаимодействовать
через пользовательский интерфейс,
должно быть реализовано с учетом следующих требований:
\begin{itemize}
    \item интерфейс должен быть интернационализован;
    \item информационные сообщения и сообщения об ошибках должны быть краткими и предельно ясными;
    \item наименования полей должны быть предельно ясными и не должны иметь сокращений и аббревиатур, за исключением специфичных для предметной области;
    \item формы настроек должны быть удобными и понятными;
    \item экранные формы должны быть однотипными и унифицированными.
\end{itemize}

\subsubsection{Требования к квалификации и численности обслуживающего персонала}

Обслуживающих персонал RRS --- те же специалисты, которые занимаются обслуживанием NCC:
инженеры тех.~поддержки от компании Naumen или партнеров,
либо обученные системные администраторы.
Дополнительных требований для них не предоставляется.

Численность обслуживающего персонала должна быть достаточной для поддержания работоспособности RRS в рабочее время.

\subsubsection{Требования к защите информации от несанкционированного доступа}

Защита данных от несанкционированного доступа должна быть реализована через поднятие защищенного внутреннего контура и запрет на доступ из внешней сети.
Защита взаимодействия с NauCore обеспечивается самим NauCore.
Ключ доступа к NauCore должен быть защищен от чтения и записи любым пользователем, кроме специально созданного для системы NCC.

\subsubsection{Требования по сохранности информации при авариях}

Все агрегированные данные должны быть удалены после перезапуска, чтобы не исказить статистику.

\subsubsection{Требования к защите от влияния внешних воздействий}

Защита RRS от внешних воздействий должна обеспечиваться за счет размещения программных средств RRS на контролируемой территории на площадях, предоставляемых клиентом Naumen.

\subsubsection{Требования к патентной чистоте}

RRS не должен включать исходные коды с copyleft лицензией, либо лицензией требующей любые денежные взносы в пользу авторов исходных кодов.

\subsubsection{Требования по стандартизации и унификации}

\Abbrev{XML}{eXtensible Markup Language --- расширяемый язык разметки}
\Abbrev{YAML}{Yet Another Markup Language --- ещё один язык разметки}
\Abbrev{JSON}{JavaScript Object Notation --- текстовый формат обмена данными, основанный на JavaScript}
\begin{itemize}
    \item для интерфейсов пользователя должен быть использован общий стиль оформления принятый в NCC PMS;
    \item название интерфейсов команд, регистрируемых в NauCore, должны удовлетворять принятому соглашению в NCC;
    \item все системные настройки сервиса должны храниться в одном из следующих форматов: XML, YAML, JSON\@;
\end{itemize}

\subsubsection{Требования к программному обеспечению}

Технические требования регулируются общими рекомендациями по NCC.

RRS должна функционировать на базе следующего системного програмнного обеспечения:
\begin{itemize}
    \item операционная система: Oracle Linux 7.x, RedHat Enterprise Linux или CentOS;
    \item СУБД: PostgreSQL 9.6 или Oracle DB 11g.
\end{itemize}

\subsubsection{Дополнительные требования}

При разработке сервиса нужно учитывать высокую нагрузку и запуск на многопроцессорных системах.

\section{Требования к функциям, выполняемым системой}

\subsection{Подсистема для хранения и доступа к нечувствительной ко времени информации}

Подсистема предназначена для хранения статистической информации в необработанном виде,
такая информация не должна быть чувствительной ко времени,
например, к ней относится:
\begin{itemize}
    \item информация по завершенным звонкам,
    \item информация по результатам сессии оператора,
    \item суммарная информация по проектам.
\end{itemize}
Так же к статистической информации относятся данные, для которых нужно делать сложную выборку,
для удобства такие данные должны дублироваться в подсистеме хранения статистической информации,
при этом они становятся не чувствительными ко времени.

\Abbrev{SQL}{structured query language --- язык структурированных запросов}
К подсистме предъявляются нижеперечисленные требования:
\begin{itemize}
    \item должна быть возможность получить статистическую информацию с помощью SQL-запроса;
    \item статистические данные должны очищаться через настраиваемый промежуток времени;
    \item скорость доступа к таким данным регулируется общими рекомендациями по NCC PMS;
    \item в потоке сохраняемой информации не должно быть разрывов,
    каждое записываемое событие за хранимый промежуток времени должно быть записано,
    если из-за аварии произошел пропуск данных,
    все данные за хранимый промежуток времени должны быть удалены;
    \item подсистема должна поддерживать используемые в NCC СУБД\@.
\end{itemize}

\subsection{Подсистема для хранения и предоставления быстрого доступа для чувствительной ко времени информации}

Предназначена для хранения и быстрого доступа к чувствительным ко времени данным,
например, текущий статус звонка, текущий статус оператора, или текущее состояние проекта.

К ней предъявляются следующие требования:
\begin{itemize}
    \item данные должны удаляться через короткий заданный промежуток времени, в случае,
    если по каким-то причинам RRS не смог в штатном режиме их очистить;
    \item время доступа к данных должно быть не более 1 секунды;
    \item обновление данных на актуальные должно проходить в пределах пары сотен миллисекунд;
    \item данные должны храниться ввиде пары <<ключ -- значение>>;
    \item должна быть возможность доступа к подсистеме внешними сервисами по API;
    \item после каждого перезапуска RRS данные в подсистеме должны удаляться.
\end{itemize}

\subsection{Подсистема взаимодействия с пользователем}

Содержит пользовательский веб-интерфейс, позволяет изменять настройки отображения выводимых данных.

Клиентский интерфейс должен обеспечивать следующие функции:
\begin{itemize}
    \item изменение представления выводимых данных;
    \item выбор объектов для наблюдения;
    \item изменение времени обновления данных;
    \item наглядность выводимых данных;
    \item фильтрация выводимых данных по заданным фильтрам, с возможностью сохранения настроек;
    \item к подсистеме должен быть доступ из графического интерфейса PMS\@.
\end{itemize}

Доступ к интерфейсу должен предоставляться только зарегистрированным и авторизованным в PMS пользователям.

\subsection{Подсистема для сбора данных по call-центру}

Подсистема должна собирать в режиме реального времени различные данные пол call-центру, такие как:
\begin{itemize}
    \item состояние активных операторов;
    \item состояние активных проектов;
    \item состояние активных звонков.
\end{itemize}

Полученные данные подсистема должна сохранять в подсистемы хранения данных, в зависимости от типа данных.

Подсистема должна успевать актуализировать информацию не менее чем за пару сотен миллисекунд.

Подсистема должна уметь масштабироваться в зависимости от нагрузки и уметь утилизировать несколько ядер в многоядерных системах.

Подсистема должна следить за корректностью предоставляемых данных и в случае некорректности очищать их.

Подсистема должна уметь одновременно обрабатывать несколько различных событий.

\section{Требования к документированию} %todo подумать над правильными гостами

Техническая документация по RRS должна соответствовать документации по NCC
и должна быть размещена на общем портале NCC.

Документы должны быть представлены в виде оригиналов на бумажном носителе и в электронном виде – в формате HTML\@.

Оформление технических документов должно производиться по ЕСПД (ГОСТ 19-106 и ГОСТ 19-104).

Пояснительная записка к техническому проекту должна быть оформлена в соответствии с ГОСТ 19.404-79.

Руководство пользователя должно быть оформлено по РД 50-34.698-90.

Руководство администратора должно быть оформлено по ГОСТ 19.505-79.

Программа и методика испытания должна быть оформлена по ГОСТ 19.301-79 ЕСПД.

Протокол испытаний должен быть оформлен по ГОСТ 24.208-80.